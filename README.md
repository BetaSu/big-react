# Big-React

ä»é›¶å®ç° React v18 çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œç‰¹ç‚¹å¦‚ä¸‹ï¼š

- ğŸ‘¬ ä¸ React æºç æœ€æ¥è¿‘çš„å®ç°
- ğŸ’ª åŠŸèƒ½å®Œå¤‡ï¼Œå½“å‰å¯è·‘é€šå®˜æ–¹æµ‹è¯•ç”¨ä¾‹æ•°é‡ï¼š34
- ğŸš¶ æŒ‰`Git Tag`åˆ’åˆ†è¿­ä»£æ­¥éª¤ï¼Œè®°å½•ä» 0 å®ç°çš„æ¯ä¸ªåŠŸèƒ½

å¦‚æœæƒ³è·Ÿç€æˆ‘å­¦ä¹ ã€Œå¦‚ä½•ä» 0 åˆ° 1 å®ç° React18ã€ï¼Œå¯ä»¥[ç‚¹å‡»è¿™é‡Œ](https://qux.xet.tech/s/2wiFh1)

## TODO List

### å·¥ç¨‹ç±»éœ€æ±‚

| ç±»å‹ | å†…å®¹                               | å®Œæˆæƒ…å†µ | åœ¨å“ªä¸ªç‰ˆæœ¬å®ç°çš„                                  |
| ---- | ---------------------------------- | -------- | ------------------------------------------------- |
| æ¶æ„ | monorepoï¼ˆpnpm å®ç°ï¼‰              | âœ…       | [v1](https://github.com/BetaSu/big-react/tree/v1) |
| è§„èŒƒ | eslint                             | âœ…       | [v1](https://github.com/BetaSu/big-react/tree/v1) |
| è§„èŒƒ | prettier                           | âœ…       | [v1](https://github.com/BetaSu/big-react/tree/v1) |
| è§„èŒƒ | commitlint + husky                 | âœ…       | [v1](https://github.com/BetaSu/big-react/tree/v1) |
| è§„èŒƒ | lint-staged                        | âœ…       | [v1](https://github.com/BetaSu/big-react/tree/v1) |
| è§„èŒƒ | tsc                                | âœ…       | [v1](https://github.com/BetaSu/big-react/tree/v1) |
| æµ‹è¯• | jest ç¯å¢ƒæ­å»º                      | âœ…       | [v4](https://github.com/BetaSu/big-react/tree/v4) |
| è§„èŒƒ | tsc                                | âœ…       | [v1](https://github.com/BetaSu/big-react/tree/v1) |
| æ„å»º | babel é…ç½®                         | âœ…       | [v4](https://github.com/BetaSu/big-react/tree/v4) |
| æ„å»º | Dev ç¯å¢ƒåŒ…çš„æ„å»º                   | âœ…       | [v1](https://github.com/BetaSu/big-react/tree/v1) |
| æ„å»º | Prod ç¯å¢ƒåŒ…çš„æ„å»º                  | â¬œï¸      |                                                   |
| éƒ¨ç½² | Github Action æ‰§è¡Œ lint ä¸ test    | â¬œï¸      |                                                   |
| éƒ¨ç½² | Github Action æ ¹æ® tag å‘å¸ƒ npm åŒ… | â¬œï¸      |                                                   |

### æ¡†æ¶éœ€æ±‚

| ç±»å‹       | å†…å®¹                                   | å®Œæˆæƒ…å†µ | åœ¨å“ªä¸ªç‰ˆæœ¬å®ç°çš„                                                                                     |
| ---------- | -------------------------------------- | -------- | ---------------------------------------------------------------------------------------------------- |
| React      | JSX è½¬æ¢                               | âœ…       | [v1](https://github.com/BetaSu/big-react/tree/v1)                                                    |
| React      | React.isValidElement                   | âœ…       | [v4](https://github.com/BetaSu/big-react/tree/v4)                                                    |
| ReactDOM   | æµè§ˆå™¨ç¯å¢ƒ DOM çš„æ’å…¥                  | âœ…       | [v2](https://github.com/BetaSu/big-react/tree/v2)                                                    |
| ReactDOM   | æµè§ˆå™¨ç¯å¢ƒ DOM çš„ç§»åŠ¨                  | âœ…       | [v7](https://github.com/BetaSu/big-react/tree/v7)                                                    |
| ReactDOM   | æµè§ˆå™¨ç¯å¢ƒ DOM çš„å±æ€§å˜åŒ–              | â¬œï¸      |                                                                                                      |
| ReactDOM   | æµè§ˆå™¨ç¯å¢ƒ DOM çš„åˆ é™¤                  | âœ…       | [v5](https://github.com/BetaSu/big-react/tree/v5)                                                    |
| ReactDOM   | ReactTestUtils                         | âœ…       | [v4](https://github.com/BetaSu/big-react/tree/v4)                                                    |
| ReactNoop  | ReactNoop Renderer                     | âœ…       | [v10](https://github.com/BetaSu/big-react/tree/v10)                                                  |
| Reconciler | Fiber æ¶æ„                             | âœ…       | [v1](https://github.com/BetaSu/big-react/tree/v1)                                                    |
| Reconciler | äº‹ä»¶æ¨¡å‹                               | âœ…       | [v6](https://github.com/BetaSu/big-react/tree/v6)                                                    |
| Reconciler | onClick äº‹ä»¶æ”¯æŒ                       | âœ…       | [v6](https://github.com/BetaSu/big-react/tree/v6)                                                    |
| Reconciler | input å…ƒç´  onChange äº‹ä»¶æ”¯æŒ           | â¬œï¸      |                                                                                                      |
| Reconciler | Lane æ¨¡å‹                              | âœ…       | [v8](https://github.com/BetaSu/big-react/tree/v8)                                                    |
| Reconciler | åŸºç¡€ Update æœºåˆ¶                       | âœ…       | [v1](https://github.com/BetaSu/big-react/tree/v1)                                                    |
| Reconciler | å¸¦ä¼˜å…ˆçº§çš„ Update æœºåˆ¶                 | âœ…       | [v8](https://github.com/BetaSu/big-react/tree/v8)                                                    |
| Reconciler | æ’å…¥å•èŠ‚ç‚¹çš„ mount æµç¨‹                | âœ…       | [v1](https://github.com/BetaSu/big-react/tree/v1)                                                    |
| Reconciler | æ’å…¥å¤šèŠ‚ç‚¹çš„ mount æµç¨‹                | âœ…       | [v7](https://github.com/BetaSu/big-react/tree/v7)                                                    |
| Reconciler | æ’å…¥å•èŠ‚ç‚¹çš„ reconcile æµç¨‹            | âœ…       | [v5](https://github.com/BetaSu/big-react/tree/v5)                                                    |
| Reconciler | æ’å…¥å¤šèŠ‚ç‚¹çš„ reconcile æµç¨‹            | âœ…       | [v7](https://github.com/BetaSu/big-react/tree/v7)                                                    |
| Reconciler | åˆ é™¤èŠ‚ç‚¹çš„ reconcile æµç¨‹              | âœ…       | [v5](https://github.com/BetaSu/big-react/tree/v5)                                                    |
| Reconciler | HostText ç±»å‹æ”¯æŒ                      | âœ…       | [v2](https://github.com/BetaSu/big-react/tree/v2)                                                    |
| Reconciler | HostComponent ç±»å‹æ”¯æŒ                 | âœ…       | [v1](https://github.com/BetaSu/big-react/tree/v1)                                                    |
| Reconciler | HostRoot ç±»å‹æ”¯æŒ                      | âœ…       | [v1](https://github.com/BetaSu/big-react/tree/v1)                                                    |
| Reconciler | FunctionComponent ç±»å‹æ”¯æŒ             | âœ…       | [v3](https://github.com/BetaSu/big-react/tree/v3)                                                    |
| React      | Hooks æ¶æ„ mount æ—¶å®ç°                | âœ…       | [v3](https://github.com/BetaSu/big-react/tree/v3)                                                    |
| React      | Hooks æ¶æ„ update æ—¶å®ç°               | âœ…       | [v5](https://github.com/BetaSu/big-react/tree/v5)                                                    |
| Reconciler | useState å®ç°                          | âœ…       | [v3](https://github.com/BetaSu/big-react/tree/v3)                                                    |
| Reconciler | useEffect å®ç°                         | âœ…       | [v9](https://github.com/BetaSu/big-react/tree/v9)                                                    |
| Reconciler | useRef å®ç°                            | âœ…       | [ref](https://github.com/BetaSu/big-react/commit/41e1b4aff567804a872a19674c1a6efcce07abf6)           |
| Reconciler | Legacy è°ƒåº¦æµç¨‹ï¼ˆåŒ…å« batchedUpdatesï¼‰ | âœ…       | [v8](https://github.com/BetaSu/big-react/tree/v8)                                                    |
| Reconciler | Concurrent è°ƒåº¦æµç¨‹                    | âœ…       | [v11](https://github.com/BetaSu/big-react/tree/v11)                                                  |
| Reconciler | useTransition å®ç°                     | âœ…       | [useTransition](https://github.com/BetaSu/big-react/commit/e0754721e1d11465bafc25c0360604a536e16d60) |
| Reconciler | useContext åŠ context æµç¨‹å®ç°         | âœ…       | [context å®ç°](https://github.com/BetaSu/big-react/commit/18d25044415b8d3e558d7027e23607d01c03f40a)  |
| Reconciler | unwind æµç¨‹                            | âœ…       | [unwind æµç¨‹](https://github.com/BetaSu/big-react/commit/18d25044415b8d3e558d7027e23607d01c03f40a)   |
| Reconciler | Suspense ç»„ä»¶å®ç°                      | âœ…       | [Suspense](https://github.com/BetaSu/big-react/commit/306bcf975bca29c19b4d5423cdf01ed7af131c32)      |
| Reconciler | Offscreen ç»„ä»¶å®ç°                     | âœ…       | [Offscreen](https://github.com/BetaSu/big-react/commit/306bcf975bca29c19b4d5423cdf01ed7af131c32)     |
| Reconciler | use hook å®ç°                          | âœ…       | [use hook](https://github.com/BetaSu/big-react/commit/306bcf975bca29c19b4d5423cdf01ed7af131c32)      |
| React | React.lazy å®ç°                          | âœ…       |  [Lazy å®ç°](https://github.com/BetaSu/big-react/pull/49/files) ç”±[L-Qun](https://github.com/L-Qun)å®Œæˆ    |
| React | React.memo å®ç°                          | âœ…       |  [React.memo å®ç°](https://github.com/BetaSu/big-react/commit/bb1cedd2a4e6ba99562d28fdaa38e52d8da70525)   |
| Reconciler | bailoutæ€§èƒ½ä¼˜åŒ–ç­–ç•¥                          | âœ…       |  [bailout å®ç°](https://github.com/BetaSu/big-react/commit/bb1cedd2a4e6ba99562d28fdaa38e52d8da70525)    |
| Reconciler | eagerStateæ€§èƒ½ä¼˜åŒ–ç­–ç•¥                          | âœ…       |  [eagerState å®ç°](https://github.com/BetaSu/big-react/commit/bb1cedd2a4e6ba99562d28fdaa38e52d8da70525)   |
| Reconciler | useMemo å®ç°                         | âœ…       |  [useMemo å®ç°](https://github.com/BetaSu/big-react/commit/bb1cedd2a4e6ba99562d28fdaa38e52d8da70525)    |
| Reconciler | useCallback å®ç°                          | âœ…       |  [useCallback å®ç°](https://github.com/BetaSu/big-react/commit/bb1cedd2a4e6ba99562d28fdaa38e52d8da70525)    |
| Reconciler | contextå…¼å®¹bailoutç­–ç•¥                          | âœ…       |  [contextå…¼å®¹](https://github.com/BetaSu/big-react/commit/bb1cedd2a4e6ba99562d28fdaa38e52d8da70525)    |




## è°ƒè¯•

æä¾› 3 ç§è°ƒè¯•æ–¹å¼ï¼š

1. å®æ—¶è°ƒè¯•

æ‰§è¡Œ`pnpm demo`ä¼šè¿è¡Œé¡¹ç›®`demos`ç›®å½•ä¸‹çš„ç¤ºä¾‹é¡¹ç›®ï¼ˆé»˜è®¤é¡¹ç›®æ˜¯é’ˆå¯¹[v9](https://github.com/BetaSu/big-react/tree/v9)çš„è°ƒè¯•é¡¹ç›®ï¼‰

è¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯ï¼š

- æ§åˆ¶å°ä¼šæ‰“å°å„ä¸ªä¸»è¦æ­¥éª¤çš„æ‰§è¡Œä¿¡æ¯ï¼Œå¯ä»¥ç›´è§‚çœ‹åˆ°æ‰§è¡Œæµç¨‹

- çƒ­æ›´æ–°ï¼ˆåŒ…æ‹¬ç¤ºä¾‹ä»£ç å’Œæºç ä»£ç ï¼‰

2. pnpm link

é€šè¿‡`CRA`æˆ–`Vite`èµ·ä¸€ä¸ª`React`æµ‹è¯•é¡¹ç›®åï¼Œåœ¨æœ¬é¡¹ç›®æ‰§è¡Œ`pnpm run build:dev`æ‰“åŒ…`react`ä¸`react-dom`ï¼Œåœ¨æµ‹è¯•é¡¹ç›®ä¸­é€šè¿‡`pnpm link`å°†é¡¹ç›®ä¾èµ–çš„`react`ä¸`react-dom`æ›¿æ¢ä¸ºæˆ‘ä»¬æ‰“åŒ…çš„`react`ä¸`react-dom`

è¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯ï¼šæœ€è´´åˆé¡¹ç›®ä¸­å®é™…ä½¿ç”¨`React`çš„æƒ…å†µ

3. è·‘`React`å®˜æ–¹çš„æµ‹è¯•ç”¨ä¾‹

æ‰§è¡Œ`pnpm test`è·‘å®˜æ–¹çš„æµ‹è¯•ç”¨ä¾‹ï¼Œç”¨ä¾‹ä¸­å¼•ç”¨çš„æ˜¯æ‰§è¡Œ`pnpm run build:dev`æ‰“åŒ…çš„`react`ä¸`react-dom`

è¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯ï¼šå¯ä»¥ä»å®˜æ–¹ç”¨ä¾‹çš„è§’åº¦è§‚å¯Ÿæ¡†æ¶å®ç°çš„ç»†èŠ‚ã€å„ç§è¾¹ç•Œæƒ…å†µ

## æ›´æ–°æ—¥å¿—

### [v11](https://github.com/BetaSu/big-react/tree/v11)

å®ç°äº†å¹¶å‘æ›´æ–°ï¼Œé€šè¿‡ä¿®æ”¹ packages/react-dom/src/SyntheticEvent.ts ä¸­çš„ eventTypeToEventPriority æ–¹æ³•ä¸‹çš„ click å¯¹åº”ä¼˜å…ˆçº§ï¼Œ
å¯ä»¥è§‚å¯ŸåŒæ­¥æ›´æ–°ï¼ˆSyncLaneï¼‰ä¸å…¶ä»–ä¼˜å…ˆçº§ä¸‹çš„ç‚¹å‡»äº‹ä»¶ä¸­è§¦å‘æ›´æ–°çš„åŒºåˆ«ï¼ˆæ˜¯å¦ä¼šå¼€å¯æ—¶é—´åˆ‡ç‰‡ï¼‰ã€‚åŒ…æ‹¬å¦‚ä¸‹åŠŸèƒ½ï¼š

- Concurrent è°ƒåº¦æµç¨‹

### [v10](https://github.com/BetaSu/big-react/tree/v10)

è¿™ä¸€ç‰ˆçš„æ”¹åŠ¨æ¯”è¾ƒå¤§ï¼Œä¸ºäº†å®ç° React-Noop-Rendererï¼Œå¯¹ React-Reconciler ä¸ rollup é…ç½®åšäº†ä¸€äº›è°ƒæ•´ï¼Œä½¿ React-Reconciler æ›´é€šç”¨ï¼ˆå¯ä»¥å¯¹æ¥ä¸åŒå®¿ä¸»ç¯å¢ƒï¼‰ã€‚åŒ…æ‹¬å¦‚ä¸‹åŠŸèƒ½ï¼š

- å®ç° React-Noop-Rendererï¼Œå¯ä»¥è„±ç¦» ReactDOM æ›´å¥½çš„æµ‹è¯• Recocniler é€»è¾‘

- å¯¹ rollup é…ç½®åšäº†æ”¹åŠ¨ï¼Œä»¥é…åˆ React-Reconciler æ›´å¥½å¯¹æ¥ä¸åŒå®¿ä¸»ç¯å¢ƒ

- å¼•å…¥ React çš„å†…éƒ¨åŒ… jest-reactã€react-test-rendererï¼Œé…åˆè‡ªåˆ¶çš„ React-Noop-Renderer æµ‹è¯•å¹¶å‘æƒ…å†µä¸‹çš„ React case

- è·‘é€š useEffect è°ƒç”¨é¡ºåºçš„ case

- ä¿®å¤äº†è¿‡ç¨‹ä¸­å‘ç°çš„ Diff ç®—æ³•çš„å° bug

- Schedulerã€jest-reactã€react-test-renderer å‡é‡‡ç”¨ NPM åŒ…å½¢å¼å¼•å…¥

### [v9](https://github.com/BetaSu/big-react/tree/v9)

å®ç°äº† useEffectï¼Œä¸ºäº†å®ç° useEffect å›è°ƒçš„å¼‚æ­¥è°ƒåº¦ï¼Œå¼•å…¥äº†å®˜æ–¹çš„ scheduler æ¨¡å—ã€‚å½“å‰ scheduler æ¨¡å—çš„ç”Ÿäº§ç¯å¢ƒç‰ˆæœ¬æ”¾åœ¨ packages ç›®å½•ä¸‹ï¼Œæ–¹ä¾¿å¯¹ä»–è¿›è¡Œä¿®æ”¹ã€‚å¦‚æœåæœŸè¯å®æ²¡æœ‰éœ€è¦ç‰¹åˆ«ä¿®æ”¹çš„åœ°æ–¹ï¼Œä¼šè€ƒè™‘ä»¥ NPM åŒ…çš„å½¢å¼å¼•å…¥ schedulerã€‚åŒ…æ‹¬å¦‚ä¸‹åŠŸèƒ½ï¼š

- useEffect å®ç°

### [v8](https://github.com/BetaSu/big-react/tree/v8)

å®ç°äº†åŸºç¡€åŠŸèƒ½çš„ Lane æ¨¡å‹ï¼Œå¯ä»¥è°ƒåº¦åŒæ­¥æ›´æ–°ï¼Œå¹¶åŸºäºæ­¤å®ç°äº† batchedUpdatesï¼ˆæ‰¹å¤„ç†ï¼‰ï¼ŒåŒ…æ‹¬å¦‚ä¸‹åŠŸèƒ½ï¼š

- Lane æ¨¡å‹

- å¸¦ä¼˜å…ˆçº§çš„ Update æœºåˆ¶

- Legacy è°ƒåº¦æµç¨‹ï¼ˆåŒ…å« batchedUpdatesï¼‰

- ä¿®å¤äº†å¤šä¸ªå­èŠ‚ç‚¹ä¸­ number ç±»å‹èŠ‚ç‚¹ä¸æ”¯æŒçš„ bug

### [v7](https://github.com/BetaSu/big-react/tree/v7)

å®ç°äº†å¤šèŠ‚ç‚¹ reconcile æµç¨‹ï¼ˆä¿—ç§°çš„ Diff ç®—æ³•ï¼‰ï¼ŒåŒ…æ‹¬å¦‚ä¸‹åŠŸèƒ½ï¼š

- ä¿®å¤äº† update æ—¶ onClick å›è°ƒä¸æ›´æ–°çš„ bug

- æ’å…¥å¤šèŠ‚ç‚¹çš„ mount æµç¨‹

- æ’å…¥å¤šèŠ‚ç‚¹çš„ reconcile æµç¨‹

- æµè§ˆå™¨ç¯å¢ƒ DOM çš„ç§»åŠ¨

Diff ç®—æ³•çš„æµ‹è¯•ç”¨ä¾‹è¿˜ä¾èµ– useEffectã€useRef çš„å®ç°ï¼Œæ”¾åœ¨åé¢å†å®ç°

### [v6](https://github.com/BetaSu/big-react/tree/v6)

å®ç°äº‹ä»¶ç³»ç»Ÿï¼ŒåŒ…æ‹¬å¦‚ä¸‹åŠŸèƒ½ï¼š

- äº‹ä»¶æ¨¡å‹
- onClick äº‹ä»¶æ”¯æŒï¼ˆä»¥åŠ onClickCapture äº‹ä»¶ï¼‰

### [v5](https://github.com/BetaSu/big-react/tree/v5)

å®ç°å•èŠ‚ç‚¹ updateï¼ŒåŒ…æ‹¬å¦‚ä¸‹åŠŸèƒ½ï¼š

- æµè§ˆå™¨ç¯å¢ƒ DOM çš„åˆ é™¤ï¼ˆæ¯”å¦‚ h3 å˜ä¸º pï¼Œé‚£ä¹ˆå°±è¦ç»å†åˆ é™¤ h3ã€æ’å…¥ pï¼‰
- æ’å…¥å•èŠ‚ç‚¹çš„ reconcile æµç¨‹ï¼ˆåŒ…æ‹¬ HostComponentã€HostTextï¼‰
- åˆ é™¤èŠ‚ç‚¹çš„ reconcile æµç¨‹ï¼ˆä¸ºåç»­ refã€useEffect ç‰¹æ€§åšå‡†å¤‡ï¼Œå®ç°çš„æ¯”è¾ƒå®Œå¤‡ï¼‰
- Hooks æ¶æ„ update æ—¶å®ç°

### [v4](https://github.com/BetaSu/big-react/tree/v4)

åˆå§‹åŒ–æµ‹è¯•ç›¸å…³æ¶æ„ï¼ŒåŒ…æ‹¬å¦‚ä¸‹åŠŸèƒ½ï¼š

- å®ç° React.isValidElement
- jest ç¯å¢ƒæ­å»º
- babel é…ç½®
- ReactTestUtils
- è·‘é€šå…³äº jsx çš„ 17 ä¸ªå®˜æ–¹ç”¨ä¾‹

### [v3](https://github.com/BetaSu/big-react/tree/v3)

å®ç° useState çš„ mount æ—¶æµç¨‹ï¼ŒåŒ…æ‹¬å¦‚ä¸‹åŠŸèƒ½ï¼š

- FunctionComponent ç±»å‹æ”¯æŒ
- Hooks æ¶æ„ mount æ—¶å®ç°
- useState å®ç°

### [v2](https://github.com/BetaSu/big-react/tree/v2)

æ’å…¥å•èŠ‚ç‚¹çš„ mount æµç¨‹ï¼ˆå¯ä»¥åœ¨æµè§ˆå™¨ç¯å¢ƒæ¸²æŸ“ DOMï¼‰ï¼ŒåŒ…æ‹¬å¦‚ä¸‹åŠŸèƒ½ï¼š

- æµè§ˆå™¨ç¯å¢ƒ DOM çš„æ’å…¥
- HostText ç±»å‹æ”¯æŒ

### [v1](https://github.com/BetaSu/big-react/tree/v1)

æ’å…¥å•èŠ‚ç‚¹çš„ render é˜¶æ®µ mount æµç¨‹ï¼ŒåŒ…æ‹¬å¦‚ä¸‹åŠŸèƒ½ï¼š

- JSX è½¬æ¢
- Fiber æ¶æ„
- æ’å…¥å•èŠ‚ç‚¹çš„ reconcile æµç¨‹
- HostComponent ç±»å‹æ”¯æŒ
- HostRoot ç±»å‹æ”¯æŒ

æ³¨ï¼šè¿˜æœªå®ç°æµè§ˆå™¨ç¯å¢ƒä¸‹çš„æ¸²æŸ“
